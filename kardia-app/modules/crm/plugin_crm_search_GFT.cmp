$Version=2$
plugin_crm_search_lists "widget/component-decl"
    {
    stage_label = "Gift Given";
    stage_short_label = "Gift";
    stage_description_expr = "isnull((select isnull('Fund: ' + :param:fund + ', ', '') + isnull('Comment: ' + :param:comment + ', ', '') + isnull('Min: ' + :param:minamt + ', ', '') + isnull('Max: ' + :param:maxamt + ', ', '') + isnull('Gift Types: ' + :param:gift_type + ', ', '') + isnull('Gift After: ' + substring(convert(string,:param:start),1,12) + ', ', '') + isnull('Gift Before: ' + substring(convert(string,:param:end),1,12) + ', ', '') - ', ' from /apps/kardia/modules/crm/advanced_search_params.qyp param where :param:p_search_id = :ss:p_search_id and :param:p_search_stage_id = :ss:p_search_stage_id), '(click to configure)')";
    stage_type = "GFT";
    icon = "/apps/kardia/images/icons/openiconic-dollar.svg";
    sequence = 20;
    width=410;
    height=164;

    criteria_osrc "widget/parameter" { type=object; }
    criteria_params_osrc "widget/parameter" { type=object; find_container="widget/osrc"; }
    criteria_params_form "widget/parameter" { type=object; find_container="widget/form"; }

    param_vbox "widget/vbox"
	{
	x=0; y=0;
	width=410; height=164;
	spacing=4;

	f_desig_cc "widget/component"
	    {
	    height=24;
	    path="/apps/kardia/modules/base/editbox_table.cmp";
	    field='fund';
	    text='Designation:';
	    label_width=150;
	    width=300;
	    popup_width=380;
	    popup_sql=runserver("select value = :c:a_cost_center, label = :c:a_cost_center + ' - ' + condition(isnull(:cr:a_receiptable,0) = 1, :c:a_cc_desc + ' (legacy # ' + :c:a_legacy_code + ')', '** CLOSED **') from /apps/kardia/data/Kardia_DB/a_cost_center/rows c, /apps/kardia/data/Kardia_DB/a_cc_receipting/rows cr where :c:a_is_posting = 1 and :cr:a_ledger_number =* :c:a_ledger_number and :cr:a_cost_center =* :c:a_cost_center");
	    search_field_list="a_cost_center*,*a_cc_desc*,a_legacy_code*";
	    key_name="a_cost_center";
	    object_name="Fund / Cost Center";
	    popup_text="Select Designation:";
	    form=criteria_params_form;

	    desig_hints "widget/hints" { style=applyonchange,uppercase,strnull; }
	    }

	minamt "widget/component" { path="/sys/cmp/smart_field.cmp"; field=minamt; height=24; width=300; label_width=150; form=criteria_params_form; text="Min Gift Amt:"; min_hints "widget/hints" { style=strnull; } }
	maxamt "widget/component" { path="/sys/cmp/smart_field.cmp"; field=maxamt; height=24; width=300; label_width=150; form=criteria_params_form; text="Max Gift Amt:"; max_hints "widget/hints" { style=strnull; } }
	gift_type "widget/component" { path="/sys/cmp/smart_field.cmp"; field=gift_type; height=24; width=300; label_width=150; form=criteria_params_form; text="Gift Type(s):"; ctl_type=dropdown; sql = "select :text, :tag from /apps/kardia/data/Kardia_DB/_a_gift_type/rows ; select text = 'EFT or Credit Card', tag = 'ED'; select text = 'Cash or Check', tag = 'CK'"; numdisplay=7; }
	gift_comm "widget/component" { path="/sys/cmp/smart_field.cmp"; field=comment; height=24; width=300; label_width=150; form=criteria_params_form; text="Gift Comment:"; comm_hints "widget/hints" { style=strnull; } }

	gift_dates "widget/hbox"
	    {
	    height=24;
	    spacing=10;
	    startdate "widget/component"
		{
		form=criteria_params_form;
		path="/sys/cmp/smart_field.cmp";
		field=start;
		text="Gift Between:";
		width=250;
		label_width=150;
		ctl_type=datetime;
		date_only=1; default_time="00:00:00";
		}
	    enddate "widget/component"
		{
		form=criteria_params_form;
		path="/sys/cmp/smart_field.cmp";
		field=end;
		text="And:";
		width=140;
		label_width=40;
		ctl_type=datetime;
		date_only=1; default_time="23:59:59";
		}
	    }
	}
    }
