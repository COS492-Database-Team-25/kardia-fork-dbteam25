$Version=2$
iconbar "widget/component-decl"
    {
    width=1000;
    height=76;

    SidebarSelect "widget/component-decl-event" { }
    TypesChange "widget/component-decl-event" { }
    ButtonPressed "widget/component-decl-event" { }
    NewPartner "widget/component-decl-event" { }
    EditPartner "widget/component-decl-event" { }

    ActivePageID "widget/parameter" { type=integer; default=1; }
    EnabledTypes "widget/parameter" { type=string; default=""; deploy_to_client=yes; }
    profile "widget/parameter" { type=object; deploy_to_client=yes; }

    prev_enabled_types "widget/variable" { value=""; }
    processing_toggle_off "widget/variable" { value=0; }

    SetNumber "widget/component-decl-action" { }
    onSetNumber1 "widget/connector" { event=SetNumber; target=one_tabbutton; action=SetNumber; Number=runclient(:Number); Which=runclient(:Which); Color=runclient(:Color); }
    onSetNumber2 "widget/connector" { event=SetNumber; target=newperson_btn; action=SetNumber; Number=runclient(:Number); Which=runclient(:Which); Color=runclient(:Color); }

    DisableTabButtons "widget/component-decl-action" { }

    types_change_event "widget/connector"
	{
	source=EnabledTypes;
	event=DataChange;
	target=iconbar;
	action=TypesChange;
	}

    disable_all_buttons "widget/connector"
	{
	event=DisableTabButtons;
	target=one_tabbutton;
	action=SetBackground;
	Image=runclient("/sys/images/trans_1.gif");
	//Image=runclient(null);
	}

    ToggleAll "widget/component-decl-action" { }

    on_toggle_set_proc "widget/connector"
	{
	event=ToggleAll;
	target=processing_toggle_off;
	action=SetValue;
	Value=runclient(condition(:prev_enabled_types:value == "", 1, 0));
	}
    on_toggle_all_set_types1 "widget/connector"
	{
	event=ToggleAll;
	event_condition=runclient(:processing_toggle_off:value == 0);
	target=EnabledTypes;
	action=SetValue;
	Value=runclient(:prev_enabled_types:value);
	}
    on_toggle_all_set_prev "widget/connector"
	{
	event=ToggleAll;
	target=prev_enabled_types;
	action=SetValue;
	Value=runclient(condition(:processing_toggle_off:value == 1, :EnabledTypes:value, ""));
	}
    on_toggle_all_set_types2 "widget/connector"
	{
	event=ToggleAll;
	event_condition=runclient(:processing_toggle_off:value == 1);
	target=EnabledTypes;
	action=SetValue;
	Value=runclient(:except + ',ADDR,PAR');
	}
    on_toggle_1 "widget/connector" { event=ToggleAll; target=rels_btn; action=Update; }
    on_toggle_2 "widget/connector" { event=ToggleAll; target=tags_btn; action=Update; }
    on_toggle_3 "widget/connector" { event=ToggleAll; target=gifts_btn; action=Update; }
    on_toggle_3b "widget/connector" { event=ToggleAll; target=comms_btn; action=Update; }
    //on_toggle_4 "widget/connector" { event=ToggleAll; target=social_btn; action=Update; }
    on_toggle_5 "widget/connector" { event=ToggleAll; target=contacts_btn; action=Update; }
    on_toggle_6 "widget/connector" { event=ToggleAll; target=ptodo_btn; action=Update; }
    on_toggle_7 "widget/connector" { event=ToggleAll; target=notes_btn; action=Update; }
    on_toggle_8 "widget/connector" { event=ToggleAll; target=webf_btn; action=Update; }
    on_toggle_9 "widget/connector" { event=ToggleAll; target=form_btn; action=Update; }
    on_toggle_10 "widget/connector" { event=ToggleAll; target=trk_btn; action=Update; }

    // Menubar
    menu_pane "widget/pane"
	{
	x=0; y=0; width=1000; height=76;
	fl_height=0;
	widget_class = crm_iconbar;

	icons_hbox "widget/hbox"
	    {
	    x=8; y=0; width=984; height=76;
	    spacing=0;
	    justify=all;

	    tabicons "widget/repeat"
		{
		sql = "select :cx__rowid, :icon, :title from object wildcard '/apps/kardia/modules/*/plugin_crm_sidebar_*.cmp' order by :sequence";

		one_tabbutton "widget/component"
		    {
		    width=48;
		    fl_width=0;
		    active=runserver(:tabicons:cx__rowid == 0);
		    path="button_tab.cmp";
		    text=runserver(:tabicons:title);
		    image=runserver(:tabicons:icon);

		    tabbutton_click0 "widget/connector"
			{
			event=Click;
			target=iconbar;
			action=TriggerEvent;
			EventName=runclient("DisableTabButtons");
			}

		    tabbutton_click "widget/connector"
			{
			event=Click;
			target=iconbar;
			action=SidebarSelect;
			PageID=runserver(:tabicons:cx__rowid + 1);
			}

		    tabbutton_click3 "widget/connector"
			{
			event=Click;
			target=one_tabbutton;
			action=SetBackground;
			Image=runclient("/apps/kardia/images/bg/lsblue_gradient.png");
			}
		    }
		}

	    sep1 "widget/autolayoutspacer" { width=24; fl_width=100; }

	    newperson_btn "widget/component"
		{
		width=48;
		fl_width=0;
		path="button_generic.cmp";
		text = "New";
		image="/apps/kardia/images/icons/ionicons-person-add.svg";
		enabled = 1;
		do_new "widget/connector" { event=Click; target=iconbar; action=NewPartner; Origin=newperson_btn; }
		}
	    editperson_btn "widget/component"
		{
		width=48;
		fl_width=0;
		path="button_generic.cmp";
		text = "Edit";
		image="/apps/kardia/images/icons/ionicons-person-edit.svg";
		enabled = runclient(char_length(:profile:p_partner_key) > 0);
		do_edit "widget/connector" { event=Click; target=iconbar; action=EditPartner; Origin=contacts_btn; }
		}

	    sep1b "widget/autolayoutspacer" { width=24; fl_width=100; }

	    labels_vbox "widget/vbox"
		{
		width=42;
		fl_width=0;
		spacing=0;

		sep2 "widget/autolayoutspacer" { height=13; }

		add_manage_pane "widget/pane"
		    {
		    style=flat;
		    fl_width=0;
		    border_radius=5;
		    width=64;
		    bgcolor="#334466";
		    height=39;

		    add_manage "widget/label"
			{
			x=0; y=7;
			width=40;
			height=20;
			style=italic;
			text = "Add+\nEdit:";
			font_size=11;
			align=right;
			fgcolor = "#a0a0a0";
			}
		    }

		sep3 "widget/autolayoutspacer" { height=5; }

		on_timeline_pane "widget/pane"
		    {
		    style=flat;
		    fl_width=0;
		    border_radius=5;
		    width=64;
		    bgcolor="#334466";
		    height=15;

		    on_timeline "widget/label"
			{
			x=0; y=1;
			width=40;
			height=12;
			style=italic;
			text = "Show:";
			font_size=11;
			align=right;
			fgcolor = "#a0a0a0";
			}
		    }
		}

	    sepn "widget/autolayoutspacer" { width=4; fl_width=0; }

	    rels_btn "widget/component"
		{
		width=48;
		fl_width=0;
		type = "REL";
		enabled_types = EnabledTypes;
		init_enabled_types = runserver(:this:EnabledTypes);
		path="button_type.cmp";
		text = "Relate";
		image="/apps/kardia/images/icons/ionicons-relationships3.svg";
		enabled = runclient(char_length(:profile:p_partner_key) > 0);
		ontoggle1 "widget/connector" { event=ToggleAll; target=iconbar; action=TriggerEvent; EventName=runclient('ToggleAll'); except=runclient(:except); }
		}

	    tags_btn "widget/component"
		{
		width=48;
		fl_width=0;
		type = "TAG";
		enabled_types = EnabledTypes;
		init_enabled_types = runserver(:this:EnabledTypes);
		path="button_type.cmp";
		text = "Tags";
		image="/apps/kardia/images/icons/ionicons-pricetags.svg";
		enabled = runclient(char_length(:profile:p_partner_key) > 0);
		ontoggle2 "widget/connector" { event=ToggleAll; target=iconbar; action=TriggerEvent; EventName=runclient('ToggleAll'); except=runclient(:except); }
		do_tags "widget/connector" { event=Click; target=iconbar; action=ButtonPressed; Button=runclient('Tags'); Origin=tags_btn; }
		}

	    gifts_btn "widget/component"
		{
		width=48;
		fl_width=0;
		type = "GIFT";
		enabled_types = EnabledTypes;
		init_enabled_types = runserver(:this:EnabledTypes);
		path="button_type.cmp";
		text = "Gifts";
		image="/apps/kardia/images/icons/openiconic-dollar.svg";
		enabled = runclient(char_length(:profile:p_partner_key) > 0);
		ontoggle3 "widget/connector" { event=ToggleAll; target=iconbar; action=TriggerEvent; EventName=runclient('ToggleAll'); except=runclient(:except); }
		}

	    comms_btn "widget/component"
		{
		width=48;
		fl_width=0;
		type = "COMM";
		enabled_types = EnabledTypes;
		init_enabled_types = runserver(:this:EnabledTypes);
		path="button_type.cmp";
		text = "Mail";
		image="/apps/kardia/images/icons/openiconic-envelope-closed.svg";
		enabled = runclient(char_length(:profile:p_partner_key) > 0);
		ontoggle3b "widget/connector" { event=ToggleAll; target=iconbar; action=TriggerEvent; EventName=runclient('ToggleAll'); except=runclient(:except); }
		}

	    social_btn "widget/component"
		{
		condition=0;
		width=48;
		fl_width=0;
		type = "SOC";
		enabled_types = EnabledTypes;
		init_enabled_types = runserver(:this:EnabledTypes);
		path="button_type.cmp";
		text = "Social";
		image="/apps/kardia/images/icons/ionicons-social.svg";
		enabled = runclient(char_length(:profile:p_partner_key) > 0);
		ontoggle4 "widget/connector" { event=ToggleAll; target=iconbar; action=TriggerEvent; EventName=runclient('ToggleAll'); except=runclient(:except); }
		}

	    contacts_btn "widget/component"
		{
		width=48;
		fl_width=0;
		type = "CONT";
		enabled_types = EnabledTypes;
		init_enabled_types = runserver(:this:EnabledTypes);
		path="button_type.cmp";
		text = "Contact";
		image="/apps/kardia/images/icons/ionicons-contacts2.svg";
		enabled = runclient(char_length(:profile:p_partner_key) > 0);
		ontoggle5 "widget/connector" { event=ToggleAll; target=iconbar; action=TriggerEvent; EventName=runclient('ToggleAll'); except=runclient(:except); }

		do_contact "widget/connector" { event=Click; target=iconbar; action=ButtonPressed; Button=runclient('Contact'); Origin=contacts_btn; }
		}

	    ptodo_btn "widget/component"
		{
		width=48;
		fl_width=0;
		type = "TASK";
		enabled_types = EnabledTypes;
		init_enabled_types = runserver(:this:EnabledTypes);
		path="button_type.cmp";
		text = "ToDo";
		image="/apps/kardia/images/icons/openiconic-bell.svg";
		enabled = runclient(char_length(:profile:p_partner_key) > 0);
		ontoggle6 "widget/connector" { event=ToggleAll; target=iconbar; action=TriggerEvent; EventName=runclient('ToggleAll'); except=runclient(:except); }

		do_todo "widget/connector" { event=Click; target=iconbar; action=ButtonPressed; Button=runclient('ToDo'); Origin=ptodo_btn; }
		}

	    notes_btn "widget/component"
		{
		width=48;
		fl_width=0;
		type = "NOTE";
		enabled_types = EnabledTypes;
		init_enabled_types = runserver(:this:EnabledTypes);
		path="button_type.cmp";
		text = "Notes";
		image="/apps/kardia/images/icons/ionicons-notes.svg";
		enabled = runclient(char_length(:profile:p_partner_key) > 0);
		ontoggle7 "widget/connector" { event=ToggleAll; target=iconbar; action=TriggerEvent; EventName=runclient('ToggleAll'); except=runclient(:except); }

		do_notes "widget/connector" { event=Click; target=iconbar; action=ButtonPressed; Button=runclient('Notes'); Origin=notes_btn; }
		}

	    webf_btn "widget/component"
		{
		width=48;
		fl_width=0;
		type = "DATA";
		enabled_types = EnabledTypes;
		init_enabled_types = runserver(:this:EnabledTypes);
		path="button_type.cmp";
		text = "Data";
		image="/apps/kardia/images/icons/tumblicons-webform2.svg";
		enabled = runclient(char_length(:profile:p_partner_key) > 0);
		ontoggle8 "widget/connector" { event=ToggleAll; target=iconbar; action=TriggerEvent; EventName=runclient('ToggleAll'); except=runclient(:except); }
		}

	    form_btn "widget/component"
		{
		width=48;
		fl_width=0;
		type = "FILE";
		enabled_types = EnabledTypes;
		init_enabled_types = runserver(:this:EnabledTypes);
		path="button_type.cmp";
		text = "Files";
		image="/apps/kardia/images/icons/tumblicons-file.svg";
		enabled = runclient(char_length(:profile:p_partner_key) > 0);
		ontoggle9 "widget/connector" { event=ToggleAll; target=iconbar; action=TriggerEvent; EventName=runclient('ToggleAll'); except=runclient(:except); }
		}

	    trk_btn "widget/component"
		{
		width=48;
		fl_width=0;
		type = "TRK";
		enabled_types = EnabledTypes;
		init_enabled_types = runserver(:this:EnabledTypes);
		path="button_type.cmp";
		text = "Tracks";
		image="/apps/kardia/images/icons/ionicons-track.svg";
		enabled = runclient(char_length(:profile:p_partner_key) > 0);
		ontoggle10 "widget/connector" { event=ToggleAll; target=iconbar; action=TriggerEvent; EventName=runclient('ToggleAll'); except=runclient(:except); }
		do_tracks "widget/connector" { event=Click; target=iconbar; action=ButtonPressed; Button=runclient('Tracks'); Origin=trk_btn; }
		}

	    sep1c "widget/autolayoutspacer" { width=24; fl_width=100; }

	    settings_btn "widget/component"
		{
		width=48;
		fl_width=0;
		path="button_generic.cmp";
		text = "Menu";
		image="/apps/kardia/images/icons/ionicons-gear.svg";
		enabled = 1;
		do_menu "widget/connector" { event=Click; target=iconbar; action=ButtonPressed; Button=runclient('Menu'); Origin=settings_btn; }
		}
	    }
	}
    }
